
<body>


    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true"><img src="assets/userlist.jpg" style="width: 4ox;height: 40px;" alt=""> Lista de Usuarios Activos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false"><img src="assets/solicitud.png" style="width: 4ox;height: 40px; margin-right: 10px;" alt="">Lista de Solicitudes de Psicologos</a>
        </li>
        
      </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="cuerpo_gestion_dos">
                
                <div class="mat-elevation-z8 tablegen">
                    <mat-form-field class="filter" appearance="standard">
                        <mat-label>Buscar...</mat-label>
                        <input matInput (keyup)="applyFilter($event)"
                            placeholder="nombre de usuario" #input />
                    </mat-form-field>

                    <table mat-table *ngIf="datausuario"
                        [dataSource]="dataSource">
                        <!-- Position Column -->
                        <ng-container matColumnDef="nro">
                            <th mat-header-cell *matHeaderCellDef>No.</th>
                            <td mat-cell *matCellDef="let element; let i=
                                index;">{{i+1}}</td>
                        </ng-container>

                        <!-- Name Column -->
                        <ng-container matColumnDef="usuario">
                            <th mat-header-cell *matHeaderCellDef>Usuario</th>
                            <td mat-cell *matCellDef="let element">{{element.username}}</td>
                        </ng-container>

                        <!-- Weight Column -->
                        <ng-container matColumnDef="nombres">
                            <th mat-header-cell *matHeaderCellDef>Nombres</th>
                            <td mat-cell *matCellDef="let element">{{(element.nombre + '    ' + element.apellido)}}</td>
                        </ng-container>

                        <!-- Symbol Column -->
                        <ng-container matColumnDef="opciones">
                            <th mat-header-cell *matHeaderCellDef>Roles
                                asigandos</th>
                            <td mat-cell *matCellDef="let element">
                                <button type="button" data-toggle="modal"
                                    data-target="#detallerol"
                                    (click)="listarrolesactuales(element.idusuario)"
                                    class="detalle_rol"><mat-icon style="color: royalblue;" matSuffix>visibility</mat-icon></button>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="opciones2">
                            <th mat-header-cell *matHeaderCellDef>Agregar rol</th>
                            <td mat-cell *matCellDef="let element">
                                <button type="button" class="detalle_rol"
                                    data-toggle="modal"
                                    data-target="#agregarroluser"
                                    (click)="agregarrol_user(element.idusuario)"><mat-icon style="color: green;"
                                        matSuffix>control_point</mat-icon></button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns:
                            displayedColumns;"></tr>

                        <!-- Row shown when there is no matching data. -->
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="4">No data matching
                                the filter "{{input.value}}"</td>
                        </tr>
                    </table>
                    <mat-paginator [pageSize]="4" 
                    #MatPaginator1="matPaginator" [pageSizeOptions]="[3,4]"
                        showFirstLastButtons></mat-paginator>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="cuerpo_gestion_dos">
              
                <div class="mat-elevation-z8 tablegen">

                    <mat-form-field class="filter" appearance="standard">
                        <mat-label>Buscar..</mat-label>
                        <input matInput (keyup)="applyFilter2($event)"
                            placeholder="nombre de usuario" #input />
                    </mat-form-field>

                    <table mat-table *ngIf="datapsi" [dataSource]="dataSource2"
                        class="mat-elevation-z8">
                        <!-- Position Column -->
                        <ng-container matColumnDef="nro">
                            <th mat-header-cell *matHeaderCellDef>No.</th>
                            <td mat-cell *matCellDef="let element; let i=
                                index;">{{i+1}}</td>
                        </ng-container>

                        <!-- Name Column -->
                        <ng-container matColumnDef="nombres">
                            <th mat-header-cell *matHeaderCellDef>Nombre
                                Completo</th>
                            <td mat-cell *matCellDef="let element">{{element.nombre + ' '
                                + element.apellido}}</td>
                        </ng-container>

                        <!-- Weight Column -->
                        <ng-container matColumnDef="tipo">
                            <th mat-header-cell *matHeaderCellDef>Tipo</th>
                            <td mat-cell *matCellDef="let element">{{element.tipo}}</td>
                        </ng-container>

                        <ng-container matColumnDef="grupo">
                            <th mat-header-cell *matHeaderCellDef>Telefono</th>
                            <td mat-cell *matCellDef="let element">{{element.telefono}}</td>
                        </ng-container>

                        <ng-container matColumnDef="ciclo">
                            <th mat-header-cell *matHeaderCellDef>Correo</th>
                            <td mat-cell *matCellDef="let element">{{element.correo}}</td>
                        </ng-container>

                        <!-- Symbol Column -->
                        <ng-container matColumnDef="opciones">
                            <th mat-header-cell *matHeaderCellDef>Detalle</th>
                            <td mat-cell *matCellDef="let element">
                                <button type="button" data-toggle="modal"
                                    data-target="#detallepsi"
                                    (click)="detallepsi(element)"
                                    class="detalle_rol"><mat-icon style="color: royalblue;" matSuffix>visibility</mat-icon></button>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="opciones2">
                            <th mat-header-cell *matHeaderCellDef>Crear Usuario</th>
                            <td mat-cell *matCellDef="let element">
                                <button type="button" class="detalle_rol"
                                    data-toggle="modal" data-target="#crearuser"(click)="crearuser(element)"><mat-icon style="color: teal;"
                                        matSuffix>group_add</mat-icon></button>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="opciones3">
                            <th mat-header-cell *matHeaderCellDef>Rechazar Solicitud</th>
                            <td mat-cell *matCellDef="let element">
                                <button type="button" class="detalle_rol"
                                   (click)="rechazarsol(element)" ><mat-icon
                                     style="color: red;"   matSuffix>delete</mat-icon></button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns2"></tr>
                        <tr mat-row *matRowDef="let row; columns:
                            displayedColumns2;"></tr>

                        <!-- Row shown when there is no matching data. -->
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="4">No data matching
                                the filter "{{input.value}}"</td>
                        </tr>
                    </table>
                    <mat-paginator [pageSize]="3" 
                    #MatPaginator2="matPaginator" [pageSizeOptions]="[1,3]"
                        showFirstLastButtons></mat-paginator>
                </div>

            </div>
        </div>

    </div>
  
</body>


<!-- Modal Agregar rol a  Usuario -->
<div class="modal fade" id="agregarroluser" role="dialog"
    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Agregar Rol a
                    Usuario</h5>
                <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label>Roles Disponibles:</label>
                <select class="form-select" [(ngModel)]="rolactualdisp"
                    *ngIf="rolesdisponibles">
                    <option value="" selected>-- none --</option>
                    <option *ngFor="let rol of rolesdisponibles"
                        value="{{rol.idrol}}">{{rol.nombre}}</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                    (click)="cerrarrolactual()" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary"
                    [disabled]="!rolactualdisp" (click)="asignaropc_usuario()"
                    data-dismiss="modal">Guardar cambios</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Mostrar roles actuales del usuario -->
<div class="modal fade" id="detallerol" role="dialog"
    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog"role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Roles del
                    Usuario</h5>
                <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <app-spinner-blanc *ngIf="cargando"></app-spinner-blanc>
            <div class="modal-body" *ngIf="!cargando">

                <h3 *ngIf="rolesactualesdeluser.length==0">No se encontraron
                    roles asignados a este usuario!</h3>
                <table class="table" *ngIf="rolesactualesdeluser.length>=1"
                    style="width: 100%;">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Opcion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let rol of rolesactualesdeluser ;let i=
                            index">
                            <th scope="row">{{i+1}}</th>
                            <td>{{rol.nombre}}</td>
                            <td style="text-align: center;"><mat-icon
                                    style="color: red;cursor:pointer"
                                    (click)="eliminarrol_user(rol.iduser_rol)"
                                    matSuffix data-dismiss="modal">delete_forever</mat-icon></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                    (click)="cerrardata()" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>







<!-- Modal Mostrar detalle de la solicitud -->
<div class="modal fade" id="detallepsi" role="dialog"
    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog"role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="exampleModalLongTitle">   <img width="40" height="40" style="margin-right: 20px;border-radius: 50%;" src="assets/solicitante.png">Detalles de
                    la Solicitud</h6>
                <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <app-spinner-blanc *ngIf="cargando"></app-spinner-blanc>
            <div class="modal-body" *ngIf="!cargando">

             
                <div class="detalledata" *ngIf="detalleelemetn" style="width:
                    100%;">
                   

                      <h4 style="text-align: center;font-weight: bold;color:
                      #c5c5c5;text-transform: capitalize; margin-right: 0;margin-left: 0; width: 100%;margin-bottom: 25px;">
                      <img style="width: 30px;height: 30px;"
                        *ngIf="detalleelemetn.tipo=='psicologo'"
                        src="https://img.icons8.com/color/48/000000/psychology.png" />
                      <img style="width: 30px;height: 30px;"
                        *ngIf="detalleelemetn.tipo=='pastor'"
                        src="https://img.icons8.com/color/48/000000/the-pope.png" />
                      <img style="width: 30px;height: 30px;"
                        *ngIf="detalleelemetn.tipo=='estudiante'"
                        src="https://img.icons8.com/color/48/000000/student-male--v1.png"
                        />
                      {{detalleelemetn.nombre + ' ' + detalleelemetn.apellido}}</h4>
                    <div class="group-item" *ngIf="detalleelemetn.tipo=='pastor'">
                      <div class="item-info"><label>Especialidad:</label><input
                          [(ngModel)]="detalleelemetn.especialidad" disabled></div>
                      <div class="item-info"><label>Universidad:</label><input
                          [(ngModel)]="detalleelemetn.universidad" disabled></div>
                      <div class="item-info"><label>Grado Academico:</label><input
                          [(ngModel)]="detalleelemetn.grado_academico" disabled></div>
          
                    </div>
                    <div *ngIf="detalleelemetn.tipo=='psicologo'" class="group-item">
                  
                      <div class="item-info"><label>Especialidad:</label><input
                          [(ngModel)]="detalleelemetn.especialidad" disabled></div>
                          <div class="item-info"><label>Universidad:</label><input
                            [(ngModel)]="detalleelemetn.universidad" disabled></div>
                      <div class="item-info"><label>Colegiatura:</label><input
                          [(ngModel)]="detalleelemetn.n_colegiatura" disabled></div>
                      <div class="item-info"><label>Grado Academico:</label><input
                          [(ngModel)]="detalleelemetn.grado_academico" disabled></div>
          
                    </div>
                    <div *ngIf="detalleelemetn.tipo=='estudiante'" class="group-item">
                      <div class="item-info"><label>Ciclo/Grupo:</label><input
                          [(ngModel)]="detalleelemetn.ciclo + '/' + detalleelemetn.grupo" disabled></div>
                      <div class="item-info"><label>Codigo:</label><input
                          [(ngModel)]="detalleelemetn.codigo" disabled></div>
          
                    </div>




                 


                </div>
            </div>

        </div>
    </div>
</div>



<!-- Modal Crear usuario -->
<div class="modal fade" id="crearuser" role="dialog"
    aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog"role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="exampleModalLongTitle">Generar
                    Usuario</h6>
                <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <app-spinner-blanc *ngIf="cargando"></app-spinner-blanc>
            <div class="modal-body cuerpoasd2" *ngIf="!cargando">

                <div class="detalledata2" *ngIf="usuarioelement" style="width:
                    100%;">

                    <h6 class="createtitle">Datos del Solicitante:</h6>
                    <mat-form-field class="largesize2" appearance="fill">
                        <mat-label> Para:</mat-label>
                        <input matInput placeholder="Ex. Pizza" value="Sushi"
                            [(ngModel)]="usuarioelement.nombre + ' ' +
                            usuarioelement.apellido" disabled>
                    </mat-form-field>

                    <mat-form-field class="" appearance="fill">
                        <mat-label>Correo</mat-label>
                        <input matInput placeholder="Ex. Pizza" value="Sushi"
                            [(ngModel)]="usuarioelement.correo" disabled>
                    </mat-form-field>

                    <h6 class="createtitle">Credenciales:</h6>

                    <mat-form-field class="user" appearance="fill">
                        <mat-label>Usuario</mat-label>
                        <input matInput placeholder="Ex. Pizza" value="Sushi"
                            [(ngModel)]="usuario.username">
                    </mat-form-field>
                    <mat-form-field class="pass" appearance="fill">
                        <mat-label>Contraseña</mat-label>
                        <input matInput placeholder="Ex. Pizza" value="Sushi"
                            [(ngModel)]="usuario.password">
                    </mat-form-field>





                    <button class="largesize3 btn"(click)="guardarusuario()"
                        [disabled]="activo==false">Crear Usuario</button>

                </div>

            </div>

        </div>
    </div>
</div>
